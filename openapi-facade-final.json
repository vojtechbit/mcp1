{
  "openapi": "3.1.0",
  "info": {
    "title": "Alfred Assistant API",
    "version": "2.1.0",
    "description": "Complete API for managing Gmail, Google Calendar, Contacts, and Tasks. High-level macros for common workflows and low-level RPC for advanced control. All times use Europe/Prague timezone."
  },
  "servers": [
    {
      "url": "https://mcp1-oauth-server.onrender.com/api",
      "description": "Production server"
    }
  ],
  "paths": {
    "/macros/inbox/overview": {
      "post": {
        "operationId": "macroInboxOverview",
        "summary": "Get lightweight inbox overview",
        "description": "Quick email overview without body text. Perfect for 'Who emailed me today?' Returns sender, subject, timestamp. Default returns ALL emails in timeRange (up to 200). For body snippets, use /macros/inbox/snippets.",
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "Returns ALL emails in specified timeRange by default (up to 200 max). Use filters to narrow results. If user asks 'Who emailed me today?', this returns complete list of today's emails, not just a subset. Only use maxItems if user explicitly wants to limit results (e.g., 'show me last 10 emails').",
                "properties": {
                  "timeRange": {
                    "type": "object",
                    "description": "Time window for emails. Use 'relative' property for natural periods like 'today', 'yesterday', 'thisWeek'. Automatically converts to Europe/Prague timezone. When user asks about 'today', use {relative:'today'} to get ALL today's emails.",
                    "properties": {
                      "relative": {
                        "type": "string",
                        "enum": [
                          "lastHour",
                          "last3h",
                          "last24h",
                          "today",
                          "yesterday",
                          "thisWeek",
                          "last7d"
                        ],
                        "description": "Natural time window: 'today'=ALL today's emails (00:00-23:59 Europe/Prague), 'thisWeek'=ALL this week Mon-Sun, 'last24h'=last 24 hours, 'yesterday'=ALL yesterday's emails, 'last7d'=past 7 days. Default behavior: returns ALL emails in period, not subset."
                      }
                    }
                  },
                  "maxItems": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 200,
                    "default": 100,
                    "description": "Max emails to return. Default 100 ensures complete results for typical daily/weekly volumes. ONLY reduce if user explicitly requests limited results (e.g., 'show me last 5 emails'). When user asks 'what emails today?', use default to get ALL. Max 200 total. If more exist, response includes subset=true."
                  },
                  "filters": {
                    "type": "object",
                    "description": "Optional filters to narrow results. Use when user specifies sender, attachment requirements, or inbox category. Example: 'emails from John' -> {from:'john'}, 'emails with attachments' -> {hasAttachment:true}, 'show Primary inbox' -> {category:'primary'}.",
                    "properties": {
                      "from": {
                        "type": "string",
                        "description": "Filter by sender email or name. Partial match, case-insensitive. Use when user asks about emails from specific person/company. Examples: 'john@example.com', 'john', 'acme corp'. Empty/omit for all senders."
                      },
                      "hasAttachment": {
                        "type": "boolean",
                        "description": "If true, ONLY emails with attachments. Use when user asks 'emails with files' or 'show me emails with attachments'. Omit (don't set false) for all emails regardless of attachments."
                      },
                      "category": {
                        "type": "string",
                        "enum": [
                          "primary",
                          "work",
                          "promotions",
                          "social",
                          "updates",
                          "forums"
                        ],
                        "description": "Filter by inbox category/label. Use when user asks to view specific inbox sections. Examples: 'Show me my Primary inbox' -> {category:'primary'}, 'Check Promotions' -> {category:'promotions'}, 'Social notifications' -> {category:'social'}. This maps to Gmail's internal category labels (CATEGORY_PERSONAL, CATEGORY_PROMOTIONS, etc.). Omit to search all categories."
                      }
                    }
                  }
                }
              },
              "examples": {
                "todaysEmails": {
                  "summary": "ALL today's emails (typical query)",
                  "value": {
                    "timeRange": {
                      "relative": "today"
                    }
                  }
                },
                "fromSpecificSender": {
                  "summary": "ALL emails from John today",
                  "value": {
                    "timeRange": {
                      "relative": "today"
                    },
                    "filters": {
                      "from": "john"
                    }
                  }
                },
                "limitedResults": {
                  "summary": "Last 10 emails only (user explicitly wants limit)",
                  "value": {
                    "timeRange": {
                      "relative": "today"
                    },
                    "maxItems": 10
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully retrieved email overview",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "description": "Array of email cards. Contains ALL emails in timeRange (up to maxItems limit). If user asked 'emails today', this is complete list of today's emails. Each has messageId for reading full content with /macros/email/quickRead.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "messageId": {
                            "type": "string",
                            "description": "Gmail message ID. Use with /macros/email/quickRead to read full email body and attachments."
                          },
                          "senderName": {
                            "type": "string",
                            "description": "Sender display name (e.g., 'John Smith'). Empty if not set."
                          },
                          "senderAddress": {
                            "type": "string",
                            "description": "Sender email (e.g., 'john@example.com'). Always present."
                          },
                          "subject": {
                            "type": "string",
                            "description": "Email subject. Empty string if no subject."
                          },
                          "receivedAt": {
                            "type": "string",
                            "description": "ISO 8601 timestamp when received (UTC), e.g., '2025-10-19T14:30:00Z'"
                          },
                          "inboxCategory": {
                            "type": "string",
                            "description": "Auto-category: 'primary'(important), 'work', 'alerts', 'newsletters', 'social', 'updates', 'forums', 'other'"
                          }
                        }
                      }
                    },
                    "subset": {
                      "type": "boolean",
                      "description": "If true, MORE emails exist beyond this response (exceeded maxItems limit). User should know there are additional emails. If false, this is COMPLETE list of all matching emails."
                    },
                    "nextPageToken": {
                      "type": "string",
                      "description": "Token for next page. Null if subset=false (all results included). If subset=true, inform user there are more emails and offer to fetch them."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/macros/inbox/snippets": {
      "post": {
        "operationId": "macroInboxSnippets",
        "summary": "Get inbox with email body snippets",
        "description": "Emails WITH body preview (200-300 chars) and attachment URLs. Perfect for 'What did John say?' Returns ALL matching emails by default (up to 50). Attachment URLs expire 1 hour. For full bodies, use /macros/email/quickRead.",
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "Returns ALL emails in timeRange with body snippets (up to 50 max due to snippet processing). Default behavior: complete results for user's query, not subset. Includes signed attachment download URLs (expire 1h). Lower max than overview (50 vs 200) due to body snippet processing cost.",
                "properties": {
                  "timeRange": {
                    "type": "object",
                    "description": "Time window for emails. When user asks 'what did John say today?', use {relative:'today'} to get ALL today's emails with body previews.",
                    "properties": {
                      "relative": {
                        "type": "string",
                        "enum": [
                          "lastHour",
                          "last3h",
                          "last24h",
                          "today",
                          "yesterday",
                          "thisWeek",
                          "last7d"
                        ],
                        "description": "Natural time periods. 'today'=ALL today's emails with snippets, 'thisWeek'=ALL this week's emails. Default returns complete set, not partial."
                      }
                    }
                  },
                  "maxItems": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 50,
                    "default": 50,
                    "description": "Max emails with snippets. Default 50 (max allowed) ensures complete results. Lower max than overview due to snippet processing. ONLY reduce if user explicitly wants fewer (e.g., 'show last 5 emails with preview'). When user asks 'what are today's emails about?', use default to get ALL."
                  },
                  "includeAttachments": {
                    "type": "boolean",
                    "default": true,
                    "description": "If true (default), includes signed download URLs for attachments (expire 1h). Set false only if attachments explicitly not needed for faster response. Most queries should use default true."
                  },
                  "filters": {
                    "type": "object",
                    "description": "Optional filters. Use when user specifies sender or wants only emails with attachments.",
                    "properties": {
                      "from": {
                        "type": "string",
                        "description": "Filter by sender. Use when user asks about specific person. Examples: 'john@example.com', 'john', 'acme'. Partial match."
                      },
                      "hasAttachment": {
                        "type": "boolean",
                        "description": "If true, ONLY emails with attachments. Use for 'show emails with files' queries. Omit for all emails."
                      }
                    }
                  }
                }
              },
              "examples": {
                "todayWithSnippets": {
                  "summary": "ALL today's emails with body previews",
                  "value": {
                    "timeRange": {
                      "relative": "today"
                    }
                  }
                },
                "recentFromSender": {
                  "summary": "ALL recent emails from John with previews",
                  "value": {
                    "timeRange": {
                      "relative": "last24h"
                    },
                    "filters": {
                      "from": "john"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully retrieved emails with snippets",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "description": "ALL emails in timeRange with body snippets (up to maxItems). If user asked about today's emails, this is complete set with previews.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "messageId": {
                            "type": "string",
                            "description": "Gmail message ID for reading full email"
                          },
                          "senderName": {
                            "type": "string"
                          },
                          "senderAddress": {
                            "type": "string"
                          },
                          "subject": {
                            "type": "string"
                          },
                          "receivedAt": {
                            "type": "string"
                          },
                          "snippet": {
                            "type": "string",
                            "description": "First 200-300 chars of body (plain text, HTML stripped). Enough to understand email content without reading full message."
                          },
                          "attachmentUrls": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            },
                            "description": "Signed download URLs for attachments (expire 1h). Empty array if no attachments. Max 50 per email."
                          }
                        }
                      }
                    },
                    "subset": {
                      "type": "boolean",
                      "description": "If true, more emails exist beyond limit. Inform user there are additional emails. If false, this is COMPLETE set."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/macros/email/quickRead": {
      "post": {
        "operationId": "macroEmailQuickRead",
        "summary": "Read full email bodies",
        "description": "Fetch complete email content with full body and attachments. Provide either specific IDs or Gmail search query. Format: snippet/minimal/full. Default reads ALL matching emails (up to 50). Use for 'Read email from John'.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "Read emails by ID or search query. Must provide EITHER 'ids' OR 'searchQuery'. Default format 'minimal' (5KB) balances speed and completeness. Returns ALL matching emails up to 50 max. When user says 'read emails from John about project', this reads ALL matching emails, not subset.",
                "properties": {
                  "ids": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "minItems": 1,
                    "maxItems": 50,
                    "description": "Array of Gmail message IDs (alternative to searchQuery)"
                  },
                  "searchQuery": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Gmail search query (alternative to ids)"
                  },
                  "format": {
                    "type": "string",
                    "enum": [
                      "snippet",
                      "minimal",
                      "full"
                    ],
                    "default": "minimal",
                    "description": "Body format: 'snippet'=300 chars, 'minimal'=5KB (recommended), 'full'=complete."
                  }
                },
                "oneOf": [
                  {
                    "type": "object",
                    "title": "Read by IDs",
                    "required": [
                      "ids"
                    ],
                    "properties": {
                      "ids": {
                        "type": "array"
                      },
                      "format": {
                        "type": "string"
                      }
                    }
                  },
                  {
                    "type": "object",
                    "title": "Read by search query",
                    "required": [
                      "searchQuery"
                    ],
                    "properties": {
                      "searchQuery": {
                        "type": "string"
                      },
                      "format": {
                        "type": "string"
                      }
                    }
                  }
                ]
              },
              "examples": {
                "readByIds": {
                  "summary": "Read 2 specific emails by ID",
                  "value": {
                    "ids": [
                      "18abc123def456",
                      "18abc789xyz012"
                    ],
                    "format": "minimal"
                  }
                },
                "searchAndRead": {
                  "summary": "Find and read ALL John's project emails",
                  "value": {
                    "searchQuery": "from:john@example.com subject:project",
                    "format": "minimal"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully retrieved email(s)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "description": "Response mode: 'single' if 1 email, 'batch' if multiple. Contains complete email content for ALL requested/matching emails.",
                  "properties": {
                    "mode": {
                      "type": "string",
                      "enum": [
                        "single",
                        "batch"
                      ],
                      "description": "'single'=1 email (use 'item'), 'batch'=multiple emails (use 'items' array)"
                    },
                    "item": {
                      "type": "object",
                      "description": "Single email (when mode='single'). Contains full content.",
                      "properties": {
                        "messageId": {
                          "type": "string"
                        },
                        "subject": {
                          "type": "string"
                        },
                        "body": {
                          "type": "string",
                          "description": "Email body in requested format. Plain text with line breaks preserved."
                        },
                        "attachments": {
                          "type": "array",
                          "description": "Attachments with download URLs (expire 1h). Blocked files have blocked=true, url=null.",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string"
                              },
                              "mimeType": {
                                "type": "string"
                              },
                              "url": {
                                "type": "string",
                                "description": "Signed URL (expires 1h). Null if blocked."
                              },
                              "blocked": {
                                "type": "boolean",
                                "description": "True if blocked by security. No URL provided."
                              }
                            }
                          }
                        }
                      }
                    },
                    "items": {
                      "type": "array",
                      "description": "Array of emails (when mode='batch'). Contains ALL requested/matching emails."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/macros/calendar/plan": {
      "post": {
        "operationId": "macroCalendarPlan",
        "summary": "Get daily or weekly calendar schedule",
        "description": "Calendar events for day or week with status (past/ongoing/upcoming). Perfect for 'What's my schedule today?' Returns ALL events by default (up to 50). Scope: daily=single day, weekly=Mon-Sun. Europe/Prague timezone.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "scope",
                  "date"
                ],
                "description": "Returns ALL events in specified scope by default (up to 50 max). When user asks 'what's my schedule today?', returns complete daily schedule, not subset. Status computed relative to current time. Use includePast=false (default) to hide finished events.",
                "properties": {
                  "scope": {
                    "type": "string",
                    "enum": [
                      "daily",
                      "weekly"
                    ],
                    "description": "'daily'=ALL events in single day, 'weekly'=ALL events Mon-Sun of week. For 'schedule today' use daily. For 'this week' use weekly. Returns complete schedule, not partial."
                  },
                  "date": {
                    "type": "string",
                    "format": "date",
                    "description": "Anchor date (YYYY-MM-DD). Daily: this exact day. Weekly: Mon-Sun week containing this date. Examples: '2025-10-19' (today), '2025-10-26' (next week). Europe/Prague timezone."
                  },
                  "includePast": {
                    "type": "boolean",
                    "default": false,
                    "description": "If false (default), ONLY current and future events (status='ongoing' or 'upcoming'). If true, includes ALL events including past (status='past'). Use false for 'what's next?', true for 'show all today's meetings'."
                  }
                }
              },
              "examples": {
                "todaySchedule": {
                  "summary": "ALL upcoming meetings today (typical query)",
                  "value": {
                    "scope": "daily",
                    "date": "2025-10-19",
                    "includePast": false
                  }
                },
                "fullDayIncludingPast": {
                  "summary": "ALL today's meetings (past + current + future)",
                  "value": {
                    "scope": "daily",
                    "date": "2025-10-19",
                    "includePast": true
                  }
                },
                "thisWeek": {
                  "summary": "ALL this week's upcoming meetings",
                  "value": {
                    "scope": "weekly",
                    "date": "2025-10-19"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully retrieved calendar schedule",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "range": {
                      "type": "object",
                      "description": "Time range covered",
                      "properties": {
                        "start": {
                          "type": "string",
                          "description": "Range start (ISO 8601). Daily: 00:00 of date. Weekly: Monday 00:00."
                        },
                        "end": {
                          "type": "string",
                          "description": "Range end (ISO 8601). Daily: 23:59 of date. Weekly: Sunday 23:59."
                        },
                        "tz": {
                          "type": "string",
                          "description": "Always Europe/Prague"
                        }
                      }
                    },
                    "items": {
                      "type": "array",
                      "description": "ALL events in range (up to 50), sorted by start time. Complete schedule for user's query.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "eventId": {
                            "type": "string",
                            "description": "Google Calendar event ID. Use for RPC update/delete."
                          },
                          "title": {
                            "type": "string"
                          },
                          "start": {
                            "type": "string",
                            "description": "Start time (ISO 8601)"
                          },
                          "end": {
                            "type": "string",
                            "description": "End time (ISO 8601)"
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "past",
                              "ongoing",
                              "upcoming"
                            ],
                            "description": "Computed status: 'past'=ended, 'ongoing'=happening now, 'upcoming'=not started. Relative to current time."
                          },
                          "locationText": {
                            "type": "string",
                            "description": "Location: room, address, or video link"
                          },
                          "attendees": {
                            "type": "array",
                            "description": "Meeting attendees"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/macros/calendar/schedule": {
      "post": {
        "operationId": "macroCalendarSchedule",
        "summary": "Create new calendar event (create-only flow)",
        "description": "CREATE new events only; modify via /rpc/calendar op:update. Accept fixed slot or proposals[] (first free). If enrichFromContacts='ask', returns confirmToken for /macros/confirm. Auto adds Google Meet or Zoom placeholder. Limit 20 attendees, Europe/Prague timezone.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "title",
                  "when"
                ],
                "description": "Create calendar event with attendees, location, notes, optional contact enrichment, conference links, reminders. Sends calendar invites to all attendees. Max 20 attendees, max 5 reminders. Times in ISO 8601 format (Europe/Prague).",
                "properties": {
                  "title": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Event title. Be descriptive. Examples: 'Team Standup', 'Client Meeting - Acme Corp', 'Doctor Appointment'."
                  },
                  "when": {
                    "type": "object",
                    "description": "Event timing. Provide either fixed.start/end for a specific slot or proposals[] for alternatives (macro checks conflicts in order and picks the first free slot).",
                    "properties": {
                      "fixed": {
                        "type": "object",
                        "properties": {
                          "start": {
                            "type": "string",
                            "format": "date-time",
                            "description": "Start time (ISO 8601). Example: '2025-10-20T14:00:00' for Oct 20, 2:00 PM Europe/Prague."
                          },
                          "end": {
                            "type": "string",
                            "format": "date-time",
                            "description": "End time (ISO 8601). Must be after start. Example: '2025-10-20T15:00:00' for 1-hour meeting."
                          }
                        },
                        "required": [
                          "start",
                          "end"
                        ]
                      },
                      "proposals": {
                        "type": "array",
                        "description": "Alternative slots to try (conflict-checked in order). If all proposals conflict, the macro returns HTTP 409 with details.",
                        "minItems": 1,
                        "maxItems": 10,
                        "items": {
                          "type": "object",
                          "required": [
                            "start",
                            "end"
                          ],
                          "properties": {
                            "start": {
                              "type": "string",
                              "format": "date-time",
                              "description": "Proposed start time (ISO 8601)."
                            },
                            "end": {
                              "type": "string",
                              "format": "date-time",
                              "description": "Proposed end time (ISO 8601)."
                            }
                          },
                          "additionalProperties": false
                        }
                      }
                    },
                    "additionalProperties": false,
                    "anyOf": [
                      {
                        "required": [
                          "fixed"
                        ]
                      },
                      {
                        "required": [
                          "proposals"
                        ]
                      }
                    ]
                  },
                  "attendees": {
                    "type": "array",
                    "maxItems": 20,
                    "description": "Meeting attendees (max 20). Sends calendar invites. Each needs email, name optional.",
                    "items": {
                      "type": "object",
                      "required": [
                        "email"
                      ],
                      "properties": {
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "name": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "location": {
                    "type": "string",
                    "maxLength": 500,
                    "description": "Location: room/address or video link. Examples: 'Conference Room A', '123 Main St', 'https://zoom.us/j/123'."
                  },
                  "notes": {
                    "type": "string",
                    "maxLength": 2000,
                    "description": "Event description (max 2000 chars). Use for agenda, purpose, preparation instructions."
                  },
                  "conference": {
                    "type": "string",
                    "enum": [
                      "none",
                      "auto",
                      "meet",
                      "zoom"
                    ],
                    "default": "none",
                    "description": "Video link: 'none'=no video, 'meet'=Google Meet (auto-generated), 'zoom'=adds placeholder text reminding organiser to add link manually, 'auto'=currently behaves like 'none'."
                  },
                  "enrichFromContacts": {
                    "type": "string",
                    "enum": [
                      "ask",
                      "auto",
                      "off"
                    ],
                    "default": "ask",
                    "description": "Enrich attendee details from Google Contacts. 'ask'=pause and return confirmToken with suggested fields, 'auto'=auto-fill without confirmation, 'off'=skip enrichment."
                  },
                  "privacy": {
                    "type": "string",
                    "enum": [
                      "default",
                      "private",
                      "public"
                    ],
                    "description": "Visibility hint stored with pending confirmation payload (currently forwarded back untouched)."
                  },
                  "reminders": {
                    "type": "array",
                    "maxItems": 5,
                    "description": "Reminders in minutes before event (max 5). Common: 15, 30, 60, 1440 (1 day). Can set multiple: [15,60].",
                    "items": {
                      "type": "integer",
                      "minimum": 1,
                      "maximum": 1440
                    }
                  }
                }
              },
              "examples": {
                "simpleFixedTime": {
                  "summary": "Simple 30min meeting",
                  "value": {
                    "title": "Team Standup",
                    "when": {
                      "fixed": {
                        "start": "2025-10-20T09:00:00",
                        "end": "2025-10-20T09:30:00"
                      }
                    },
                    "reminders": [
                      15
                    ]
                  }
                },
                "meetingWithAttendees": {
                  "summary": "Meeting with attendees + Google Meet",
                  "value": {
                    "title": "Project Review",
                    "when": {
                      "fixed": {
                        "start": "2025-10-21T14:00:00",
                        "end": "2025-10-21T15:00:00"
                      }
                    },
                    "attendees": [
                      {
                        "email": "john@example.com",
                        "name": "John Smith"
                      }
                    ],
                    "conference": "meet",
                    "reminders": [
                      15,
                      60
                    ]
                  }
                },
                "proposedSlots": {
                  "summary": "Try multiple slots and pick first without conflicts",
                  "value": {
                    "title": "Design Sync",
                    "when": {
                      "proposals": [
                        {
                          "start": "2025-10-22T09:00:00",
                          "end": "2025-10-22T09:30:00"
                        },
                        {
                          "start": "2025-10-22T10:00:00",
                          "end": "2025-10-22T10:30:00"
                        }
                      ]
                    },
                    "attendees": [
                      {
                        "email": "alex@example.com"
                      }
                    ],
                    "enrichFromContacts": "ask"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Event created or pending confirmation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "event": {
                      "type": [
                        "object",
                        "null"
                      ],
                      "description": "Created event details. Null when confirmToken returned for enrichment.",
                      "properties": {
                        "eventId": {
                          "type": "string"
                        },
                        "title": {
                          "type": "string"
                        },
                        "start": {
                          "type": "string"
                        },
                        "end": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string",
                          "description": "Always 'upcoming' immediately after creation."
                        },
                        "attendees": {
                          "type": "array",
                          "description": "Attendee list with email/name pairs.",
                          "items": {
                            "type": "object",
                            "properties": {
                              "email": {
                                "type": "string"
                              },
                              "name": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              }
                            }
                          }
                        }
                      }
                    },
                    "confirmToken": {
                      "type": [
                        "string",
                        "null"
                      ],
                      "description": "Present when enrichFromContacts='ask' and contact data found. Call /api/macros/confirm with this token to continue."
                    },
                    "warnings": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Informational messages (e.g. enrichment suggestions or that auto-fill was applied)."
                    }
                  }
                }
              }
            }
          },
          "409": {
            "description": "All proposed time slots conflict with existing events. Response includes alternatives array.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string",
                      "enum": [
                        "CONFLICT"
                      ]
                    },
                    "alternatives": {
                      "type": "array",
                      "description": "Each item details a conflicting proposal with the conflicting events.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "proposal": {
                            "type": "object"
                          },
                          "conflicts": {
                            "type": "array"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/macros/calendar/reminderDrafts": {
      "post": {
        "operationId": "macroCalendarReminderDrafts",
        "summary": "Generate reminder email drafts for upcoming events",
        "description": "Create Gmail draft reminders for event attendees. Scopes: today (all day's events) or nextHours (next N hours). Returns draft list with generated emails ready to send. Email templates customizable.",
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "Generate reminder drafts for events. Scope: 'today'=all day's events, 'nextHours'=next N hours. Creates one draft per attendee. Templates customizable with {title}, {start}, {end}, {location}, {recipientName}.",
                "properties": {
                  "window": {
                    "type": "string",
                    "enum": [
                      "today",
                      "nextHours"
                    ],
                    "description": "Time window: 'today'=ALL events today, 'nextHours'=next N hours (requires hours param)"
                  },
                  "hours": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 24,
                    "description": "Lookahead window in hours (required when window='nextHours')"
                  },
                  "template": {
                    "type": "string",
                    "maxLength": 2000,
                    "description": "Custom email template (optional)"
                  },
                  "includeLocation": {
                    "type": "boolean",
                    "default": true,
                    "description": "Include location in reminder"
                  },
                  "createDrafts": {
                    "type": "boolean",
                    "default": true,
                    "description": "Create drafts or preview only"
                  }
                },
                "oneOf": [
                  {
                    "type": "object",
                    "title": "Generate for today",
                    "properties": {
                      "window": {
                        "type": "string"
                      },
                      "template": {
                        "type": "string"
                      },
                      "includeLocation": {
                        "type": "boolean"
                      },
                      "createDrafts": {
                        "type": "boolean"
                      }
                    }
                  },
                  {
                    "type": "object",
                    "title": "Generate for next N hours",
                    "required": [
                      "hours"
                    ],
                    "properties": {
                      "window": {
                        "type": "string"
                      },
                      "hours": {
                        "type": "integer"
                      },
                      "template": {
                        "type": "string"
                      },
                      "includeLocation": {
                        "type": "boolean"
                      },
                      "createDrafts": {
                        "type": "boolean"
                      }
                    }
                  }
                ]
              },
              "examples": {
                "todayReminders": {
                  "summary": "Generate reminders for ALL today's events",
                  "value": {
                    "window": "today"
                  }
                },
                "nextHoursReminders": {
                  "summary": "Generate reminders for next 4 hours only",
                  "value": {
                    "window": "nextHours",
                    "hours": 4
                  }
                },
                "customTemplate": {
                  "summary": "Use custom reminder template",
                  "value": {
                    "window": "today",
                    "template": "Hi {recipientName},\n\nDon't forget about {title}!\nWhen: {start}\nWhere: {location}\n\nLooking forward to seeing you!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully generated reminder drafts",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "drafts": {
                      "type": "array",
                      "description": "Email drafts created (one per attendee per event). Ready to send or customize further.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "draftId": {
                            "type": [
                              "string",
                              "null"
                            ],
                            "description": "Gmail draft ID. Use to access/modify/send via Gmail API. Null if createDrafts=false or draft creation failed."
                          },
                          "to": {
                            "type": "string",
                            "description": "Recipient email address (event attendee)"
                          },
                          "subject": {
                            "type": "string",
                            "description": "Email subject line. Format: 'Reminder: {event title}'"
                          },
                          "preview": {
                            "type": "string",
                            "description": "First 200 chars of email body for preview"
                          },
                          "eventId": {
                            "type": "string",
                            "description": "Google Calendar event ID. Use to reference original event."
                          }
                        }
                      }
                    },
                    "subset": {
                      "type": "boolean",
                      "description": "Always false. All matching events included (no pagination)"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/macros/contacts/safeAdd": {
      "post": {
        "operationId": "macroContactsSafeAdd",
        "summary": "Bulk add contacts with safety checks",
        "description": "Bulk import 1-50 contacts with duplicate detection plus confirmation. Strategies: ask (confirm), skip, merge, create. For deep cleanup use /rpc/contacts (op:\"dedupe\") then POST /contacts/actions/bulkDelete. Field 'realestate' stores organization.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "entries"
                ],
                "description": "Bulk add contacts (1-50) with duplicate detection and follow-up confirmation. Each entry needs 'name' (required), optional 'email'/'phone'/'realestate'/'notes'. Strategies: 'ask' (default, safest – pause and return confirmToken), 'skip' (do not add duplicates), 'merge' (auto-merge into best match), 'create' (always add). Matching logic: email exact match > phone match > name exact match > partial name match. For removing duplicates after review, call /rpc/contacts with op:\"dedupe\" then POST /contacts/actions/bulkDelete.",
                "properties": {
                  "entries": {
                    "type": "array",
                    "minItems": 1,
                    "maxItems": 50,
                    "description": "Contacts to add (1-50). Each: name (required), email/phone/realestate/notes (optional). Duplicate check on name/email/phone.",
                    "items": {
                      "type": "object",
                      "required": [
                        "name"
                      ],
                      "properties": {
                        "name": {
                          "type": "string",
                          "maxLength": 255,
                          "description": "Full name (required). Examples: 'John Smith', 'Jane Doe'."
                        },
                        "email": {
                          "type": "string",
                          "format": "email",
                          "description": "Email (optional but recommended). Used for duplicate check."
                        },
                        "phone": {
                          "type": "string",
                          "maxLength": 20,
                          "description": "Phone any format (optional). Examples: '+420 123 456 789', '555-1234'."
                        },
                        "realestate": {
                          "type": "string",
                          "maxLength": 500,
                          "description": "Company/org (optional). Note: field name is 'realestate'. Examples: 'Acme Corp', 'Self-employed'."
                        },
                        "notes": {
                          "type": "string",
                          "maxLength": 1000,
                          "description": "Notes (optional, max 1000). Example: 'Met at conference 2024'."
                        }
                      }
                    }
                  },
                  "dedupeStrategy": {
                    "type": "string",
                    "enum": [
                      "ask",
                      "skip",
                      "merge",
                      "create"
                    ],
                    "default": "ask",
                    "description": "Duplicate handling strategy: 'ask' (default, safest) = detect duplicates and return confirmToken for user to decide, 'skip' = skip entries with duplicates (don't add), 'merge' = auto-merge into existing (preserve existing, add new fields), 'create' = always add (may create duplicates). For safest experience, use 'ask' (requires user confirmation). For bulk imports, use 'merge'."
                  }
                }
              },
              "examples": {
                "singleContact": {
                  "summary": "Add single contact (safest: asks if duplicate)",
                  "value": {
                    "entries": [
                      {
                        "name": "John Smith",
                        "email": "john@example.com",
                        "phone": "+420 123 456 789",
                        "realestate": "Acme Corp"
                      }
                    ],
                    "dedupeStrategy": "ask"
                  }
                },
                "bulkImportAutoMerge": {
                  "summary": "Import 3 contacts with auto-merge into existing",
                  "value": {
                    "entries": [
                      {
                        "name": "Jane Doe",
                        "email": "jane@company.com"
                      },
                      {
                        "name": "Bob Wilson",
                        "email": "bob@startup.io"
                      },
                      {
                        "name": "Alice Brown",
                        "phone": "+420 999 888 777"
                      }
                    ],
                    "dedupeStrategy": "merge"
                  }
                },
                "bulkImportSkip": {
                  "summary": "Import but skip any duplicates found",
                  "value": {
                    "entries": [
                      {
                        "name": "Bob Wilson",
                        "email": "bob@startup.io"
                      }
                    ],
                    "dedupeStrategy": "skip"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Contacts processed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "created": {
                      "type": "array",
                      "description": "Successfully created new contacts. Each item: {name, email}",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "merged": {
                      "type": "array",
                      "description": "Successfully merged into existing contacts (when strategy=merge). Each item: {merged_into (email), from (name), fields_updated (array of field names)}. Preserve existing contact data, add new fields from entry.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "merged_into": {
                            "type": "string",
                            "description": "Email of existing contact that was merged into"
                          },
                          "from": {
                            "type": "string",
                            "description": "Name of new contact that was merged"
                          },
                          "fields_updated": {
                            "type": "array",
                            "description": "Which fields were updated (phone, notes, etc)"
                          }
                        }
                      }
                    },
                    "skipped": {
                      "type": "array",
                      "description": "Entries that could not be processed. Reason: 'found duplicates' (strategy=ask or skip), 'merge failed', 'add failed'. Each item: {email, name, reason, existing (duplicate contacts if found)}.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "email": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "reason": {
                            "type": "string"
                          },
                          "existing": {
                            "type": "array",
                            "description": "Existing contacts that matched (if duplicates found)"
                          }
                        }
                      }
                    },
                    "confirmToken": {
                      "type": "string",
                      "description": "Present ONLY if strategy='ask' and duplicates found. User must call /api/macros/confirm with this token and action (create/skip/merge) to proceed."
                    },
                    "warnings": {
                      "type": "array",
                      "description": "Informational messages for user (e.g., duplicate counts, reminder to confirm or to use /rpc/contacts (dedupe) + /contacts/actions/bulkDelete for cleanup)",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/macros/tasks/overview": {
      "post": {
        "operationId": "macroTasksOverview",
        "summary": "Get tasks overview",
        "description": "Google Tasks grouped by status. Scopes: daily (today only) or weekly (this week). Returns ALL tasks in scope: today/thisWeek/overdue sections, optionally completed. Use for 'What are my tasks today?'",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "scope"
                ],
                "description": "Returns ALL tasks in specified scope grouped by due date. Daily=ALL today's tasks, weekly=ALL this week's tasks. Four sections: 'today', 'thisWeek', 'overdue', 'completed' (if includeCompleted=true). Complete task list, not subset.",
                "properties": {
                  "scope": {
                    "type": "string",
                    "enum": [
                      "daily",
                      "weekly"
                    ],
                    "description": "'daily'=ALL tasks due today (24 hours). 'weekly'=ALL tasks due this week (Mon-Sun). Complete list, not subset."
                  },
                  "includeCompleted": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, includes completed tasks in 'completed' section. If false (default), only active tasks. Use true for 'what I accomplished', false for 'what's left to do'."
                  }
                }
              },
              "examples": {
                "dailyTasks": {
                  "summary": "ALL today's active tasks (typical)",
                  "value": {
                    "scope": "daily",
                    "includeCompleted": false
                  }
                },
                "weeklyTasks": {
                  "summary": "ALL this week's active tasks",
                  "value": {
                    "scope": "weekly"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Tasks retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sections": {
                      "type": "object",
                      "description": "ALL tasks grouped by section. Complete list for scope.",
                      "properties": {
                        "today": {
                          "type": "array",
                          "description": "ALL tasks due today (not completed)"
                        },
                        "thisWeek": {
                          "type": "array",
                          "description": "ALL tasks due this week (not today)"
                        },
                        "overdue": {
                          "type": "array",
                          "description": "ALL overdue tasks (past due date)"
                        },
                        "completed": {
                          "type": "array",
                          "description": "Completed tasks (if includeCompleted=true)"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rpc/contacts": {
      "post": {
        "operationId": "contactsRpc",
        "summary": "Advanced contact RPC (read-only + dedupe helpers)",
        "description": "Low-level contact helpers backed by Google Sheets. Supports list, search, add, dedupe, bulkUpsert, and addressSuggest. Mutating operations (modify, delete, bulkDelete) now live at /api/contacts/actions/modify|delete|bulkDelete.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ContactsRpcRequest"
              },
              "examples": {
                "list": {
                  "summary": "Get all contacts",
                  "value": {
                    "op": "list"
                  }
                },
                "search": {
                  "summary": "Search for 'john'",
                  "value": {
                    "op": "search",
                    "params": {
                      "query": "john"
                    }
                  }
                },
                "add": {
                  "summary": "Add single contact",
                  "value": {
                    "op": "add",
                    "params": {
                      "name": "John Smith",
                      "email": "john@example.com"
                    }
                  }
                },
                "dedupe": {
                  "summary": "Find duplicate contacts",
                  "value": {
                    "op": "dedupe"
                  }
                },
                "bulkUpsert": {
                  "summary": "Batch add contacts",
                  "value": {
                    "op": "bulkUpsert",
                    "params": {
                      "contacts": [
                        {
                          "name": "Alice",
                          "email": "alice@example.com"
                        },
                        {
                          "name": "Bob",
                          "email": "bob@example.com"
                        }
                      ]
                    }
                  }
                },
                "addressSuggest": {
                  "summary": "Get address suggestions from realEstate field",
                  "value": {
                    "op": "addressSuggest",
                    "params": {
                      "query": "Vrchlického"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean",
                      "description": "Always true on success"
                    },
                    "data": {
                      "type": "object",
                      "description": "Response data (varies by operation)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - missing or invalid parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string",
                      "enum": [
                        "INVALID_PARAM"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/rpc/mail": {
      "post": {
        "operationId": "mailRpc",
        "summary": "Advanced mail operations",
        "description": "Low-level Gmail RPC. Operations: search, preview, read, create drafts, send, reply, modify labels, preview attachments. Use macros for common tasks, RPC for advanced control. Returns ALL matching results (within op limits). Attachment URLs expire 1h.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "op"
                ],
                "properties": {
                  "op": {
                    "type": "string",
                    "enum": [
                      "search",
                      "preview",
                      "read",
                      "send",
                      "reply",
                      "modify",
                      "attachmentPreview",
                      "labels"
                    ],
                    "description": "Operation: search, preview (metadata for ids), read (full email or by search), send (direct OR by draftId), reply, modify labels, preview attachments, or manage labels list/modify."
                  },
                  "params": {
                    "anyOf": [
                      {
                        "type": "object",
                        "title": "Send Draft",
                        "description": "Send existing draft by ID (op=send with draftId)",
                        "required": [
                          "draftId"
                        ],
                        "properties": {
                          "draftId": {
                            "type": "string",
                            "pattern": "^r-[0-9]+$",
                            "example": "r-70585620154190988",
                            "description": "Draft ID returned from /macros/calendar/reminderDrafts. Format: r-XXXXXXXXX (immutable draft identifier)"
                          }
                        }
                      },
                      {
                        "type": "object",
                        "title": "Send Direct Email",
                        "description": "Send email directly without draft (op=send with to+subject+body)",
                        "required": [
                          "to",
                          "subject",
                          "body"
                        ],
                        "properties": {
                          "to": {
                            "type": "string",
                            "format": "email",
                            "example": "recipient@example.com",
                            "description": "Recipient email address"
                          },
                          "subject": {
                            "type": "string",
                            "maxLength": 255,
                            "example": "Meeting tomorrow",
                            "description": "Email subject line"
                          },
                          "body": {
                            "type": "string",
                            "maxLength": 10000,
                            "example": "Hi, reminder about meeting at 7am",
                            "description": "Email body (plain text)"
                          },
                          "cc": {
                            "type": "string",
                            "description": "CC recipients (comma-separated, optional)"
                          },
                          "bcc": {
                            "type": "string",
                            "description": "BCC recipients (comma-separated, optional)"
                          }
                        }
                      },
                      {
                        "type": "object",
                        "title": "Create Draft",
                        "description": "Create Gmail draft without sending (op=createDraft)",
                        "required": ["to", "subject", "body"],
                        "properties": {
                          "to": {
                            "type": "string",
                            "format": "email",
                            "example": "coworker@example.com",
                            "description": "Recipient for the draft"
                          },
                          "subject": {
                            "type": "string",
                            "maxLength": 255,
                            "example": "Weekly status update",
                            "description": "Draft email subject"
                          },
                          "body": {
                            "type": "string",
                            "maxLength": 20000,
                            "example": "Ahoj, tady je návrh status reportu...",
                            "description": "Plain-text body saved to the draft"
                          }
                        }
                      },
                      {
                        "type": "object",
                        "title": "Search",
                        "description": "Search emails (op=search)",
                        "required": [
                          "query"
                        ],
                        "properties": {
                          "query": {
                            "type": "string",
                            "description": "Gmail search query (from:, to:, subject:, has:attachment, etc.)"
                          },
                          "maxResults": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 100
                          }
                        }
                      },
                      {
                        "type": "object",
                        "title": "Attachment preview",
                        "description": "Preview text/table from attachment (op=attachmentPreview)",
                        "required": [
                          "messageId",
                          "attachmentId",
                          "mode"
                        ],
                        "properties": {
                          "messageId": {
                            "type": "string"
                          },
                          "attachmentId": {
                            "type": "string"
                          },
                          "mode": {
                            "type": "string",
                            "enum": [
                              "text",
                              "table"
                            ]
                          },
                          "maxKb": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 512
                          },
                          "maxRows": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 200
                          },
                          "delimiter": {
                            "type": "string",
                            "description": "Table delimiter (optional, defaults to auto)."
                          }
                        }
                      },
                      {
                        "type": "object",
                        "title": "Labels ops",
                        "description": "List or modify labels (op=labels)",
                        "properties": {
                          "list": {
                            "type": "boolean"
                          },
                          "modify": {
                            "type": "object",
                            "properties": {
                              "messageId": {
                                "type": "string"
                              },
                              "ids": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "description": "Alternative to messageId. When provided, modifies first id only (matches service)."
                              },
                              "add": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              },
                              "remove": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      },
                      {
                        "type": "object",
                        "description": "Generic parameters for other ops (preview, read, reply, modify). See examples for common shapes.",
                        "additionalProperties": true
                      }
                    ],
                    "description": "Parameters depend on op value. Specific schemas provided for common cases; other operations accept their documented fields."
                  }
                }
              },
              "examples": {
                "searchEmails": {
                  "summary": "Search with Gmail query",
                  "value": {
                    "op": "search",
                    "params": {
                      "query": "from:john@example.com subject:meeting",
                      "maxResults": 100
                    }
                  }
                },
                "sendDirectEmail": {
                  "summary": "Send email directly (FIXED: All fields required in params)",
                  "value": {
                    "op": "send",
                    "params": {
                      "to": "recipient@example.com",
                      "subject": "Meeting tomorrow",
                      "body": "Hi, reminder about meeting at 7am"
                    }
                  }
                },
                "createDraft": {
                  "summary": "Create draft without sending",
                  "value": {
                    "op": "createDraft",
                    "params": {
                      "to": "coworker@example.com",
                      "subject": "Weekly status update",
                      "body": "Ahoj! Posílám koncept reportu ke schválení."
                    }
                  }
                },
                "sendDraft": {
                  "summary": "Send existing draft by ID",
                  "value": {
                    "op": "send",
                    "params": {
                      "draftId": "18abc123def456"
                    }
                  }
                },
                "attachmentPreview": {
                  "summary": "Preview attachment text",
                  "value": {
                    "op": "attachmentPreview",
                    "params": {
                      "messageId": "1890de2cafe3a3b7",
                      "attachmentId": "ANGjdJ9XbExample",
                      "mode": "text",
                      "maxKb": 128
                    }
                  }
                },
                "listLabels": {
                  "summary": "List all Gmail labels",
                  "value": {
                    "op": "labels",
                    "params": {
                      "list": true
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation completed"
          },
          "400": {
            "description": "Invalid request format - detailed error with expected format",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {
                      "type": "string",
                      "description": "Specific format requirements"
                    },
                    "option1": {
                      "type": "object"
                    },
                    "option2": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rpc/calendar": {
      "post": {
        "operationId": "calendarRpc",
        "summary": "Advanced calendar operations",
        "description": "Low-level calendar RPC. Operations: list, get, create, update, delete, checkConflicts. Use macros for schedule/plan, RPC for advanced CRUD. Always include eventId for update/delete.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "op"
                ],
                "properties": {
                  "op": {
                    "type": "string",
                    "enum": [
                      "list",
                      "get",
                      "create",
                      "update",
                      "delete",
                      "checkConflicts"
                    ],
                    "description": "Operation type. CRITICAL for update: must include eventId and updates fields with proper start/end structure."
                  },
                  "params": {
                    "type": "object",
                    "description": "FIXED: Operation parameters. CRITICAL for update: eventId (required) + updates object with start/end as objects containing {dateTime, timeZone}.",
                    "properties": {
                      "eventId": {
                        "type": "string",
                        "description": "Event ID (REQUIRED for: get, update, delete, checkConflicts). Get from list or previous response."
                      },
                      "updates": {
                        "type": "object",
                        "description": "Fields to update (for op=update). Can include: start, end, summary, description, attendees, location, reminders. CRITICAL: start and end must be objects with {dateTime, timeZone}.",
                        "properties": {
                          "start": {
                            "type": "object",
                            "description": "FIXED: start is an OBJECT with required fields dateTime and timeZone",
                            "required": [
                              "dateTime",
                              "timeZone"
                            ],
                            "properties": {
                              "dateTime": {
                                "type": "string",
                                "format": "date-time",
                                "example": "2025-10-21T15:00:00",
                                "description": "ISO 8601 datetime (without +HH:MM in string, that's in timeZone)"
                              },
                              "timeZone": {
                                "type": "string",
                                "example": "Europe/Prague",
                                "description": "REQUIRED: Timezone identifier. Use 'Europe/Prague' or valid IANA timezone."
                              }
                            }
                          },
                          "end": {
                            "type": "object",
                            "description": "FIXED: end is an OBJECT with required fields dateTime and timeZone",
                            "required": [
                              "dateTime",
                              "timeZone"
                            ],
                            "properties": {
                              "dateTime": {
                                "type": "string",
                                "format": "date-time",
                                "example": "2025-10-21T16:00:00"
                              },
                              "timeZone": {
                                "type": "string",
                                "example": "Europe/Prague"
                              }
                            }
                          },
                          "summary": {
                            "type": "string"
                          },
                          "description": {
                            "type": "string"
                          },
                          "location": {
                            "type": "string"
                          },
                          "attendees": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "email": {
                                  "type": "string",
                                  "format": "email"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "examples": {
                "listEvents": {
                  "summary": "List ALL events in date range",
                  "value": {
                    "op": "list",
                    "params": {
                      "timeMin": "2025-10-20T00:00:00Z",
                      "timeMax": "2025-10-27T23:59:59Z"
                    }
                  }
                },
                "updateEventTime": {
                  "summary": "Reschedule event (FIXED: Proper structure with {dateTime, timeZone})",
                  "value": {
                    "op": "update",
                    "params": {
                      "eventId": "uemjv6bneskjfej5t9onrlikq0",
                      "updates": {
                        "start": {
                          "dateTime": "2025-10-21T15:00:00",
                          "timeZone": "Europe/Prague"
                        },
                        "end": {
                          "dateTime": "2025-10-21T16:00:00",
                          "timeZone": "Europe/Prague"
                        },
                        "attendees": [
                          {
                            "email": "user@example.com"
                          }
                        ]
                      }
                    }
                  }
                },
                "checkConflicts": {
                  "summary": "Check for conflicts in time slot",
                  "value": {
                    "op": "checkConflicts",
                    "params": {
                      "start": "2025-10-21T07:00:00Z",
                      "end": "2025-10-21T08:00:00Z"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation completed"
          },
          "400": {
            "description": "Invalid request format - detailed error with expected structure",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {
                      "type": "string"
                    },
                    "expectedFormat": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rpc/tasks": {
      "post": {
        "operationId": "tasksRpc",
        "summary": "Advanced tasks operations",
        "description": "Low-level tasks RPC for list, create, update, delete, and complete. Use /macros/tasks/overview for grouped views; this endpoint returns raw tasks and accepts params either inside 'params' or alongside 'op'.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TasksRpcRequest"
              },
              "examples": {
                "createTask": {
                  "summary": "Create new task",
                  "value": {
                    "op": "create",
                    "params": {
                      "title": "Review proposal",
                      "due": "2025-10-25T12:00:00Z"
                    }
                  }
                },
                "completeTaskDirect": {
                  "summary": "Complete a task using direct root-level identifiers",
                  "value": {
                    "op": "complete",
                    "taskListId": "primary",
                    "taskId": "task-42"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation completed"
          }
        }
      }
    },
    "/contacts/actions/modify": {
      "post": {
        "operationId": "contactsModify",
        "tags": [
          "Contacts"
        ],
        "summary": "Modify an existing contact (idempotent)",
        "description": "Direct mutation endpoint for GPT. Updates an existing contact identified by name+email; creates if missing. Provide Idempotency-Key header for safe retries.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ContactsModifyActionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Contact updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean"
                    },
                    "contact": {
                      "type": "object",
                      "description": "Updated contact payload"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid parameters"
          },
          "401": {
            "description": "Authentication required"
          },
          "404": {
            "description": "Not found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/contacts/actions/delete": {
      "post": {
        "operationId": "contactsDelete",
        "tags": [
          "Contacts"
        ],
        "summary": "Delete a contact (email or name)",
        "description": "Deletes a contact row from Google Sheets by email (preferred) or by unique name. Returns 409 if name matches multiple contacts.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ContactsDeleteActionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Contact deleted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean"
                    },
                    "deleted": {
                      "type": "object",
                      "description": "Deleted contact data (if available)"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid parameters"
          },
          "401": {
            "description": "Authentication required"
          },
          "404": {
            "description": "Not found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/contacts/actions/bulkDelete": {
      "post": {
        "operationId": "contactsBulkDelete",
        "tags": [
          "Contacts"
        ],
        "summary": "Bulk delete contacts (emails or rowIds)",
        "description": "Delete full contacts by email or remove duplicate rows by rowIds. Accepts up to 100 entries per call.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ContactsBulkDeleteActionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rows deleted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean"
                    },
                    "deleted": {
                      "type": "integer",
                      "description": "Number of rows removed."
                    },
                    "mode": {
                      "type": "string",
                      "enum": [
                        "emails",
                        "rowIds"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid parameters"
          },
          "401": {
            "description": "Authentication required"
          },
          "404": {
            "description": "Not found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ContactsRpcRequest": {
        "type": "object",
        "required": [
          "op"
        ],
        "description": "Contacts RPC payload backed 100% by Google Sheets (no MongoDB writes). Always include an 'op'. Parameters can be supplied either inside a nested 'params' object (legacy format) or directly at the root next to 'op'.\n\n**WORKFLOW 1 – REMOVE DUPLICATES (keep best contact, delete extras):**\n  Step 1: Call {\"op\": \"dedupe\"} → Returns groups like {rowIndex: [2,3,5]} meaning duplicates.\n  Step 2: Pick the best rowIndex (most complete data).\n  Step 3: POST /contacts/actions/bulkDelete with {\"rowIds\": [3,5]} to remove extra rows (keep row 2).\n\n**WORKFLOW 2 – DELETE ENTIRE CONTACT (all occurrences):**\n  POST /contacts/actions/bulkDelete with {\"emails\": [\"john@example.com\"]} → Deletes ALL rows with that email.\n\n**IMPORTANT:** rowIds mode = surgical delete (keeps the best row). emails mode = delete entire contact.\n\nMutating operations (modify/delete/bulkDelete) are available via /api/contacts/actions/modify, /api/contacts/actions/delete and /api/contacts/actions/bulkDelete.",
        "properties": {
          "op": {
            "type": "string",
            "enum": [
              "list",
              "dedupe",
              "search",
              "add",
              "bulkUpsert",
              "addressSuggest"
            ],
            "description": "Operation to perform against the Google Sheets contacts backend."
          },
          "params": {
            "type": "object",
            "description": "Operation-specific parameters. The schema depends on the chosen op and is validated via the referenced sub-schemas."
          }
        },
        "oneOf": [
          {
            "$ref": "#/components/schemas/ContactsListRequest"
          },
          {
            "$ref": "#/components/schemas/ContactsDedupeRequest"
          },
          {
            "$ref": "#/components/schemas/ContactsSearchRequest"
          },
          {
            "$ref": "#/components/schemas/ContactsAddRequest"
          },
          {
            "$ref": "#/components/schemas/ContactsBulkUpsertRequest"
          },
          {
            "$ref": "#/components/schemas/ContactsAddressSuggestRequest"
          }
        ],
        "x-googleSheetsParams": {
          "list": {
            "description": "List all contacts – no params needed (omit or {})."
          },
          "dedupe": {
            "description": "Find duplicate groups in Google Sheets. No params required."
          },
          "search": {
            "description": "Search contacts. Params: {query}",
            "schema": {
              "type": "object",
              "required": [
                "query"
              ],
              "properties": {
                "query": {
                  "type": "string",
                  "description": "Search expression (diacritics stripped)."
                }
              }
            }
          },
          "add": {
            "description": "Add a single contact row. Params: {name, email?, phone?, realestate?, notes?}",
            "schema": {
              "type": "object",
              "required": [
                "name"
              ],
              "properties": {
                "name": {
                  "type": "string"
                },
                "email": {
                  "type": "string"
                },
                "phone": {
                  "type": "string"
                },
                "realestate": {
                  "type": "string"
                },
                "notes": {
                  "type": "string"
                }
              }
            }
          },
          "update": {
            "description": "Update an existing contact (matched by email). Params: {email, name?, phone?, realestate?, notes?}",
            "schema": {
              "type": "object",
              "required": [
                "email"
              ],
              "properties": {
                "email": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "phone": {
                  "type": "string"
                },
                "realestate": {
                  "type": "string"
                },
                "notes": {
                  "type": "string"
                }
              }
            }
          },
          "delete": {
            "description": "Delete contacts by email or name. Params: {email? | name?}",
            "schema": {
              "type": "object",
              "properties": {
                "email": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                }
              }
            }
          },
          "bulkUpsert": {
            "description": "Upsert up to 50 contacts. Params: {contacts: Contact[]} where Contact={name, email?, phone?, realestate?, notes?}",
            "schema": {
              "type": "object",
              "required": [
                "contacts"
              ],
              "properties": {
                "contacts": {
                  "type": "array",
                  "minItems": 1,
                  "maxItems": 50,
                  "items": {
                    "type": "object",
                    "required": [
                      "name"
                    ],
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "email": {
                        "type": "string"
                      },
                      "phone": {
                        "type": "string"
                      },
                      "realestate": {
                        "type": "string"
                      },
                      "notes": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "bulkDelete": {
            "description": "Delete by emails (all rows) or rowIds (specific duplicates). Params: {emails?: string[], rowIds?: number[]}",
            "schema": {
              "oneOf": [
                {
                  "type": "object",
                  "required": [
                    "emails"
                  ],
                  "properties": {
                    "emails": {
                      "type": "array",
                      "minItems": 1,
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "additionalProperties": false
                },
                {
                  "type": "object",
                  "required": [
                    "rowIds"
                  ],
                  "properties": {
                    "rowIds": {
                      "type": "array",
                      "minItems": 1,
                      "items": {
                        "type": "integer"
                      }
                    }
                  },
                  "additionalProperties": false
                }
              ]
            }
          },
          "addressSuggest": {
            "description": "Get address suggestions for the realEstate column. Params: {query}",
            "schema": {
              "type": "object",
              "required": [
                "query"
              ],
              "properties": {
                "query": {
                  "type": "string"
                }
              }
            }
          }
        },
        "additionalProperties": false
      },
      "ContactsBaseRequest": {
        "type": "object",
        "required": [
          "op"
        ],
        "properties": {
          "op": {
            "type": "string"
          },
          "params": {
            "type": "object"
          }
        },
        "additionalProperties": false
      },
      "ContactsListRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "properties": {
              "op": {
                "const": "list"
              },
              "params": {
                "type": "object",
                "description": "No params required. Omit entirely or send {}.",
                "maxProperties": 0
              }
            }
          }
        ]
      },
      "ContactsDedupeRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "properties": {
              "op": {
                "const": "dedupe"
              },
              "params": {
                "type": "object",
                "description": "No params required. Omit entirely or send {}.",
                "maxProperties": 0
              }
            }
          }
        ]
      },
      "ContactsSearchRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "required": [
              "params"
            ],
            "properties": {
              "op": {
                "const": "search"
              },
              "params": {
                "type": "object",
                "required": [
                  "query"
                ],
                "properties": {
                  "query": {
                    "type": "string",
                    "description": "Search expression for contact sheet rows."
                  }
                },
                "additionalProperties": false
              }
            }
          }
        ]
      },
      "ContactsAddRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "required": [
              "params"
            ],
            "properties": {
              "op": {
                "const": "add"
              },
              "params": {
                "type": "object",
                "required": [
                  "name",
                  "email"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "phone": {
                    "type": "string"
                  },
                  "realestate": {
                    "type": "string"
                  },
                  "notes": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              }
            }
          }
        ]
      },
      "ContactsUpdateRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "required": [
              "params"
            ],
            "properties": {
              "op": {
                "const": "update"
              },
              "params": {
                "type": "object",
                "required": [
                  "name",
                  "email"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "phone": {
                    "type": "string"
                  },
                  "realestate": {
                    "type": "string"
                  },
                  "notes": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              }
            }
          }
        ]
      },
      "ContactsDeleteRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "required": [
              "params"
            ],
            "properties": {
              "op": {
                "const": "delete"
              },
              "params": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "name": {
                    "type": "string"
                  }
                },
                "additionalProperties": false,
                "oneOf": [
                  {
                    "required": [
                      "email"
                    ]
                  },
                  {
                    "required": [
                      "name"
                    ]
                  },
                  {
                    "required": [
                      "email",
                      "name"
                    ]
                  }
                ]
              }
            }
          }
        ]
      },
      "ContactsBulkUpsertRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "required": [
              "params"
            ],
            "properties": {
              "op": {
                "const": "bulkUpsert"
              },
              "params": {
                "type": "object",
                "required": [
                  "contacts"
                ],
                "properties": {
                  "contacts": {
                    "type": "array",
                    "minItems": 1,
                    "maxItems": 50,
                    "items": {
                      "type": "object",
                      "required": [
                        "name"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "phone": {
                          "type": "string"
                        },
                        "realestate": {
                          "type": "string"
                        },
                        "notes": {
                          "type": "string"
                        }
                      },
                      "additionalProperties": false
                    }
                  }
                },
                "additionalProperties": false
              }
            }
          }
        ]
      },
      "ContactsBulkDeleteByEmailsRequest": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/ContactsBaseRequest"
              },
              {
                "required": [
                  "params"
                ],
                "properties": {
                  "op": {
                    "const": "bulkDelete"
                  },
                  "params": {
                    "type": "object",
                    "required": [
                      "emails"
                    ],
                    "properties": {
                      "emails": {
                        "type": "array",
                        "minItems": 1,
                        "items": {
                          "type": "string",
                          "format": "email"
                        }
                      }
                    },
                    "additionalProperties": false
                  }
                }
              }
            ]
          },
          {
            "type": "object",
            "required": [
              "op",
              "emails"
            ],
            "properties": {
              "op": {
                "const": "bulkDelete"
              },
              "emails": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "string",
                  "format": "email"
                }
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "ContactsBulkDeleteByRowIdsRequest": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/ContactsBaseRequest"
              },
              {
                "required": [
                  "params"
                ],
                "properties": {
                  "op": {
                    "const": "bulkDelete"
                  },
                  "params": {
                    "type": "object",
                    "required": [
                      "rowIds"
                    ],
                    "properties": {
                      "rowIds": {
                        "type": "array",
                        "minItems": 1,
                        "items": {
                          "type": "integer"
                        }
                      }
                    },
                    "additionalProperties": false
                  }
                }
              }
            ]
          },
          {
            "type": "object",
            "required": [
              "op",
              "rowIds"
            ],
            "properties": {
              "op": {
                "const": "bulkDelete"
              },
              "rowIds": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "integer"
                }
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "ContactsAddressSuggestRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ContactsBaseRequest"
          },
          {
            "required": [
              "params"
            ],
            "properties": {
              "op": {
                "const": "addressSuggest"
              },
              "params": {
                "type": "object",
                "required": [
                  "query"
                ],
                "properties": {
                  "query": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              }
            }
          }
        ]
      },
      "TasksRpcRequest": {
        "type": "object",
        "required": [
          "op"
        ],
        "description": "Tasks RPC payload. Choose the shape that matches the desired operation so the Actions runtime can validate params correctly. Parameters may be wrapped in a 'params' object or provided directly beside 'op' (e.g. {\"op\":\"complete\", \"taskListId\":\"...\", \"taskId\":\"...\"}). The backend accepts both formats.",
        "properties": {
          "op": {
            "type": "string",
            "enum": [
              "list",
              "get",
              "create",
              "update",
              "delete",
              "complete",
              "reopen"
            ],
            "description": "Operation to execute on Google Tasks."
          },
          "params": {
            "type": "object",
            "description": "Operation-specific parameters validated by the targeted request schema."
          }
        },
        "oneOf": [
          {
            "$ref": "#/components/schemas/TasksListRequest"
          },
          {
            "$ref": "#/components/schemas/TasksGetRequest"
          },
          {
            "$ref": "#/components/schemas/TasksCreateRequest"
          },
          {
            "$ref": "#/components/schemas/TasksUpdateRequest"
          },
          {
            "$ref": "#/components/schemas/TasksDeleteRequest"
          },
          {
            "$ref": "#/components/schemas/TasksCompleteRequest"
          },
          {
            "$ref": "#/components/schemas/TasksReopenRequest"
          }
        ],
        "additionalProperties": false
      },
      "TasksBaseRequest": {
        "type": "object",
        "required": [
          "op"
        ],
        "properties": {
          "op": {
            "type": "string"
          },
          "params": {
            "type": "object"
          }
        },
        "additionalProperties": false
      },
      "TasksListRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/TasksBaseRequest"
          },
          {
            "properties": {
              "op": {
                "const": "list"
              },
              "params": {
                "type": "object",
                "properties": {
                  "taskListId": {
                    "type": "string"
                  },
                  "maxResults": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 100
                  },
                  "pageToken": {
                    "type": "string"
                  },
                  "showCompleted": {
                    "type": "boolean"
                  }
                },
                "additionalProperties": false
              }
            }
          }
        ]
      },
      "TasksGetRequest": {
        "description": "Placeholder for future single-task retrieval. Currently returns HTTP 501 (not implemented).",
        "allOf": [
          {
            "$ref": "#/components/schemas/TasksBaseRequest"
          },
          {
            "required": [
              "params"
            ],
            "properties": {
              "op": {
                "const": "get"
              },
              "params": {
                "type": "object",
                "required": [
                  "taskListId",
                  "taskId"
                ],
                "properties": {
                  "taskListId": {
                    "type": "string"
                  },
                  "taskId": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              }
            }
          }
        ]
      },
      "TasksCreateRequest": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/TasksBaseRequest"
              },
              {
                "required": [
                  "params"
                ],
                "properties": {
                  "op": {
                    "const": "create"
                  },
                  "params": {
                    "type": "object",
                    "required": [
                      "title"
                    ],
                    "properties": {
                      "title": {
                        "type": "string"
                      },
                      "notes": {
                        "type": "string"
                      },
                      "due": {
                        "type": "string",
                        "format": "date-time"
                      }
                    },
                    "additionalProperties": false
                  }
                }
              }
            ]
          },
          {
            "type": "object",
            "required": [
              "op",
              "title"
            ],
            "properties": {
              "op": {
                "const": "create"
              },
              "title": {
                "type": "string"
              },
              "notes": {
                "type": "string"
              },
              "due": {
                "type": "string",
                "format": "date-time"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "TasksUpdateRequest": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/TasksBaseRequest"
              },
              {
                "required": [
                  "params"
                ],
                "properties": {
                  "op": {
                    "const": "update"
                  },
                  "params": {
                    "type": "object",
                    "required": [
                      "taskListId",
                      "taskId",
                      "updates"
                    ],
                    "properties": {
                      "taskListId": {
                        "type": "string"
                      },
                      "taskId": {
                        "type": "string"
                      },
                      "updates": {
                        "type": "object",
                        "properties": {
                          "title": {
                            "type": "string"
                          },
                          "notes": {
                            "type": "string"
                          },
                          "due": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "needsAction",
                              "completed"
                            ]
                          }
                        }
                      }
                    },
                    "additionalProperties": false
                  }
                }
              }
            ]
          },
          {
            "type": "object",
            "required": [
              "op",
              "taskListId",
              "taskId",
              "updates"
            ],
            "properties": {
              "op": {
                "const": "update"
              },
              "taskListId": {
                "type": "string"
              },
              "taskId": {
                "type": "string"
              },
              "updates": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string"
                  },
                  "notes": {
                    "type": "string"
                  },
                  "due": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "needsAction",
                      "completed"
                    ]
                  }
                }
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "TasksDeleteRequest": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/TasksBaseRequest"
              },
              {
                "required": [
                  "params"
                ],
                "properties": {
                  "op": {
                    "const": "delete"
                  },
                  "params": {
                    "type": "object",
                    "required": [
                      "taskListId",
                      "taskId"
                    ],
                    "properties": {
                      "taskListId": {
                        "type": "string"
                      },
                      "taskId": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  }
                }
              }
            ]
          },
          {
            "type": "object",
            "required": [
              "op",
              "taskListId",
              "taskId"
            ],
            "properties": {
              "op": {
                "const": "delete"
              },
              "taskListId": {
                "type": "string"
              },
              "taskId": {
                "type": "string"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "TasksCompleteRequest": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/TasksBaseRequest"
              },
              {
                "required": [
                  "params"
                ],
                "properties": {
                  "op": {
                    "const": "complete"
                  },
                  "params": {
                    "type": "object",
                    "required": [
                      "taskListId",
                      "taskId"
                    ],
                    "properties": {
                      "taskListId": {
                        "type": "string"
                      },
                      "taskId": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  }
                }
              }
            ]
          },
          {
            "type": "object",
            "required": [
              "op",
              "taskListId",
              "taskId"
            ],
            "properties": {
              "op": {
                "const": "complete"
              },
              "taskListId": {
                "type": "string"
              },
              "taskId": {
                "type": "string"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "TasksReopenRequest": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/TasksBaseRequest"
              },
              {
                "required": [
                  "params"
                ],
                "properties": {
                  "op": {
                    "const": "reopen"
                  },
                  "params": {
                    "type": "object",
                    "required": [
                      "taskListId",
                      "taskId"
                    ],
                    "properties": {
                      "taskListId": {
                        "type": "string"
                      },
                      "taskId": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  }
                }
              }
            ]
          },
          {
            "type": "object",
            "required": [
              "op",
              "taskListId",
              "taskId"
            ],
            "properties": {
              "op": {
                "const": "reopen"
              },
              "taskListId": {
                "type": "string"
              },
              "taskId": {
                "type": "string"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "ContactsModifyActionRequest": {
        "type": "object",
        "required": [
          "name",
          "email"
        ],
        "properties": {
          "name": {
            "type": "string",
            "description": "Full name of the contact (required)."
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email address (required)."
          },
          "phone": {
            "type": "string",
            "description": "Phone number (optional)."
          },
          "notes": {
            "type": "string",
            "description": "Notes field (optional)."
          },
          "realEstate": {
            "type": "string",
            "description": "Organization/company (camelCase variant)."
          },
          "realestate": {
            "type": "string",
            "description": "Organization/company (legacy lowercase alias)."
          }
        },
        "additionalProperties": false,
        "description": "Payload for /api/contacts/modify. Provide both name and email; optional fields overwrite stored values."
      },
      "ContactsDeleteActionRequest": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email of the contact to delete."
          },
          "name": {
            "type": "string",
            "description": "Name of the contact (used when deleting by name)."
          }
        },
        "additionalProperties": false,
        "description": "Payload for /api/contacts/delete. Provide email (preferred) or name. If both supplied, both must match.",
        "anyOf": [
          {
            "required": [
              "email"
            ]
          },
          {
            "required": [
              "name"
            ]
          }
        ]
      },
      "ContactsBulkDeleteActionRequest": {
        "type": "object",
        "description": "Payload for /api/contacts/actions/bulkDelete. Choose mode: emails[] deletes full contacts, rowIds[] deletes specific rows.",
        "oneOf": [
          {
            "type": "object",
            "required": [
              "emails"
            ],
            "properties": {
              "emails": {
                "type": "array",
                "minItems": 1,
                "maxItems": 100,
                "items": {
                  "type": "string",
                  "format": "email"
                },
                "description": "Emails whose rows should be removed (deletes all rows matching each email)."
              }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": [
              "rowIds"
            ],
            "properties": {
              "rowIds": {
                "type": "array",
                "minItems": 1,
                "maxItems": 100,
                "items": {
                  "type": "integer",
                  "minimum": 2
                },
                "description": "Sheet row indexes to delete (1-based, e.g. 2 removes second contact row)."
              }
            },
            "additionalProperties": false
          }
        ]
      }
    }
  }
}
